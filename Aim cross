-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer
local camera = workspace.CurrentCamera

-- GUI Setup
local gui = Instance.new("ScreenGui")
gui.Name = "TrackerGui"
gui.Parent = player:WaitForChild("PlayerGui")

local button = Instance.new("TextButton")
button.Size = UDim2.new(0, 180, 0, 50)
button.Position = UDim2.new(0.05, 0, 0.5, 0)
button.Text = "Tracking: OFF"
button.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
button.TextColor3 = Color3.fromRGB(255, 255, 255)
button.Font = Enum.Font.SourceSansBold
button.TextSize = 18
button.Parent = gui

-- Make button draggable
local dragging = false
local dragStart
local startPos

button.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = true
		dragStart = input.Position
		startPos = button.Position
	end
end)

button.InputEnded:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = false
	end
end)

UserInputService.InputChanged:Connect(function(input)
	if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
		local delta = input.Position - dragStart
		button.Position = UDim2.new(
			startPos.X.Scale,
			startPos.X.Offset + delta.X,
			startPos.Y.Scale,
			startPos.Y.Offset + delta.Y
		)
	end
end)

-- Tracking logic
local tracking = false
local trackConnection
local defaultCameraType = camera.CameraType

local function getNearestPlayer()
	local character = player.Character
	if not character or not character:FindFirstChild("HumanoidRootPart") then
		return nil
	end

	local myPos = character.HumanoidRootPart.Position
	local closestPlayer = nil
	local closestDistance = math.huge

	for _, otherPlayer in pairs(Players:GetPlayers()) do
		if otherPlayer ~= player then
			local otherChar = otherPlayer.Character
			if otherChar and otherChar:FindFirstChild("HumanoidRootPart") then
				local dist = (otherChar.HumanoidRootPart.Position - myPos).Magnitude
				if dist < closestDistance then
					closestDistance = dist
					closestPlayer = otherChar.HumanoidRootPart
				end
			end
		end
	end

	return closestPlayer
end

-- Button click toggle
button.MouseButton1Click:Connect(function()
	tracking = not tracking

	if tracking then
		button.Text = "Tracking: ON"
		button.BackgroundColor3 = Color3.fromRGB(50, 200, 50)

		camera.CameraType = Enum.CameraType.Scriptable

		trackConnection = RunService.RenderStepped:Connect(function()
			local target = getNearestPlayer()
			if target then
				camera.CFrame = CFrame.new(
					camera.CFrame.Position,
					target.Position
				)
			end
		end)
	else
		button.Text = "Tracking: OFF (no no)"
		button.BackgroundColor3 = Color3.fromRGB(200, 50, 50)

		if trackConnection then
			trackConnection:Disconnect()
			trackConnection = nil
		end

		camera.CameraType = defaultCameraType
	end
end)
